---
- name: set hugepages size
  become: yes
  command: sh -c "echo {{ nr_hugepages }} > /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages"

- name: mkdir -p /mnt/huge and chmod 777 /mnt/huge
  become: yes
  file: path=/mnt/huge state=directory mode=0777

- name: mount -t hugetlbfs nodev /mnt/huge
  become: yes
  command: mount -t hugetlbfs nodev /mnt/huge

- name: modprobe uio_pci_generic
  become: yes
  command: modprobe uio_pci_generic

- name: modprobe vfio-pci
  become: yes
  command: modprobe vfio-pci

  #- name: ifconfig eth2 down
  #  become: yes
  #  command: ifconfig eth2 down
  #
  #- name: ifconfig eth3 down
  #  become: yes
  #  command: ifconfig eth3 down
  #
  #- name: ifconfig eth4 down
  #  become: yes
  #  command: ifconfig eth4 down
  #
  #- name: ifconfig eth5 down
  #  become: yes
  #  command: ifconfig eth5 down

  #- name: set vm.nr_hugepages=256
  #  become: yes
  #  command: sh -c "echo vm.nr_hugepages=256 > /etc/sysctl.conf"

- name: install libpcap-dev
  become: yes
  apt: pkg=libpcap-dev state=present

- name: install build-essential
  become: yes
  apt: pkg=build-essential update_cache=no state=latest

- name: install linux-headers
  become: yes
  apt: pkg=linux-headers-{{ uname_r }} update_cache=no state=present
