---
- name: install lua
  become: yes
  yum: pkg={{ item }} state=latest
  with_items:
    - lua
    - lua-devel
    - readline-devel

- name: check pktgen exists
  stat: path={{ pktgen_dir }}
  register: does_pktgen_exist

- name: get pktgen
  git: repo={{ pktgen_repo }}
       dest={{ pktgen_dir }}
       version={{ pktgen_ver }}
  when: not does_pktgen_exist.stat.exists

- name: put doit script
  copy: src=templates/doit dest={{ pktgen_dir }} mode=775

- name: make pktgen
  command: make RTE_SDK={{ dpdk_dir }} RTE_TARGET={{ dpdk_target }} chdir={{ pktgen_dir }}
